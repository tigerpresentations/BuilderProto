<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D GLB Scene Editor - Canvas-to-Texture Pipeline</title>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow: hidden; background: #1a1a1a; color: #fff; }
        canvas#three-canvas { position: fixed; top: 0; left: 0; z-index: 1; }
        
        /* Controls Panel - Three.js-style */
        #controls { position: fixed; top: 10px; left: 10px; background: rgba(20, 20, 20, 0.95); border: 1px solid #333; border-radius: 6px; padding: 12px; width: 280px; max-height: calc(100vh - 40px); overflow-y: auto; z-index: 100; font-size: 12px; backdrop-filter: blur(10px); }
        
        .collapsible-panel { margin-bottom: 12px; border: 1px solid #444; border-radius: 4px; background: rgba(40, 40, 40, 0.6); }
        .panel-header { background: #333; padding: 8px 12px; cursor: pointer; user-select: none; display: flex; justify-content: space-between; align-items: center; border-radius: 3px 3px 0 0; }
        .panel-header:hover { background: #444; }
        .panel-toggle { font-size: 10px; color: #aaa; }
        .panel-content { padding: 10px; }
        .collapsible-panel.collapsed .panel-content { display: none; }
        
        .control-group { margin-bottom: 12px; }
        .control-group label { display: block; margin-bottom: 4px; color: #ccc; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
        .control-group input, .control-group select { width: 100%; padding: 6px 8px; background: #222; border: 1px solid #555; border-radius: 3px; color: #fff; font-size: 11px; }
        .control-group input[type="range"] { padding: 0; height: 20px; }
        .control-group input:focus { outline: none; border-color: #0084ff; box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.2); }
        
        button { background: #333; color: #fff; border: 1px solid #555; padding: 8px 12px; border-radius: 3px; cursor: pointer; font-size: 11px; }
        button:hover { background: #444; }
        button:active { background: #222; }
        
        /* Range Slider Styling */
        input[type="range"] { -webkit-appearance: none; appearance: none; height: 4px; background: #444; outline: none; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #0084ff; cursor: pointer; border-radius: 50%; }
        input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; background: #0084ff; cursor: pointer; border-radius: 50%; border: none; }
        
        .slider-value { display: inline-block; min-width: 40px; text-align: right; color: #0084ff; font-weight: 500; }
        
        /* Drop Zone */
        #drop-zone { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; height: 200px; border: 2px dashed #555; border-radius: 8px; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 50; background: rgba(30, 30, 30, 0.9); transition: all 0.3s ease; }
        #drop-zone.dragging { border-color: #0084ff; background: rgba(0, 132, 255, 0.1); }
        #drop-zone.hidden { display: none; }
        #drop-zone p { margin: 0; text-align: center; color: #aaa; }
        
        /* Canvas Editor Panel */
        #canvas-editor { position: fixed; top: 10px; right: 10px; background: rgba(20, 20, 20, 0.95); border: 1px solid #333; border-radius: 6px; width: 450px; max-height: calc(100vh - 40px); overflow-y: auto; z-index: 100; backdrop-filter: blur(10px); transition: width 0.3s ease; }
        #canvas-editor.panel-collapsed { width: auto; max-width: 200px; }
        
        /* Canvas Container */
        .canvas-container { padding: 12px; display: flex; flex-direction: column; align-items: center; }
        #display-canvas { 
            border: 2px solid #555; 
            border-radius: 4px; 
            max-width: 100%; 
            height: auto; 
            background: white; 
            cursor: default; 
        }
        
        #display-canvas:hover { border-color: #777; }
        #display-canvas.dragging { cursor: move; }
        #display-canvas.resizing { cursor: nw-resize; }
        
        /* Image Tools - Simplified */
        .image-tools { margin-top: 12px; }
        .tool-section { 
            margin-bottom: 16px; 
            padding: 12px; 
            background: rgba(40, 40, 40, 0.6); 
            border-radius: 4px; 
        }
        
        .tool-section h4 { 
            margin: 0 0 12px 0; 
            font-size: 12px; 
            color: #ccc; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        
        /* File Input Styling */
        .file-input-wrapper { 
            position: relative; 
            display: inline-block; 
            width: 100%; 
        }
        
        .file-input-wrapper input[type=file] { 
            position: absolute; 
            opacity: 0; 
            width: 100%; 
            height: 100%; 
            cursor: pointer; 
        }
        
        .file-input-display { 
            display: block; 
            padding: 8px 12px; 
            background: #333; 
            color: #fff; 
            border: 1px solid #555; 
            border-radius: 3px; 
            text-align: center; 
            cursor: pointer; 
        }
        
        .file-input-display:hover { background: #444; }
        
        /* Layer Management */
        .layer-list { 
            max-height: 200px; 
            overflow-y: auto; 
            border: 1px solid #555; 
            border-radius: 3px; 
            background: #222; 
        }
        
        .layer-item { 
            padding: 8px 12px; 
            border-bottom: 1px solid #333; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
        }
        
        .layer-item:last-child { border-bottom: none; }
        .layer-item:hover { background: #333; }
        .layer-item.selected { background: #0084ff; color: white; }
        
        .layer-info { 
            flex: 1; 
            font-size: 11px; 
        }
        
        .layer-controls { 
            display: flex; 
            gap: 4px; 
        }
        
        .layer-controls button { 
            padding: 4px 6px; 
            font-size: 10px; 
            min-width: auto; 
        }
        
        button.primary { background: #0084ff; border-color: #0084ff; }
        button.primary:hover { background: #0066cc; }
        button.danger { background: #cc3333; border-color: #cc3333; }
        button.danger:hover { background: #aa2222; }
        
        /* Color Modal */
        #colorModal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a1a; padding: 24px; border-radius: 8px; width: 400px; max-width: 90vw; border: 1px solid #333; }
        .color-preview { width: 60px; height: 60px; border: 2px solid #555; border-radius: 6px; margin: 12px 0; }
        .recent-colors { display: flex; gap: 8px; margin: 12px 0; }
        .swatch-preview { width: 24px; height: 24px; border: 1px solid #555; border-radius: 4px; cursor: pointer; }
        .swatch-preview:hover { border-color: #0084ff; }
        
        /* Quick Swatches */
        #quickSwatches { display: flex; gap: 4px; align-items: center; }
        
        /* UI Resizer */
        .ui-resizer { position: absolute; background: #333; opacity: 0.3; transition: opacity 0.2s; }
        .ui-resizer:hover, .ui-resizer.resizing { opacity: 0.8; }
        .ui-resizer.vertical { top: 0; right: -3px; width: 6px; height: 100%; cursor: ew-resize; }
        .ui-resizer.horizontal { bottom: -3px; left: 0; width: 100%; height: 6px; cursor: ns-resize; }
        
        /* Performance Info */
        .performance-info { position: fixed; bottom: 10px; right: 10px; background: rgba(20, 20, 20, 0.9); padding: 8px 12px; border-radius: 4px; font-size: 10px; color: #aaa; z-index: 50; }
    </style>
</head>
<body>
    <!-- Drop Zone -->
    <div id="drop-zone">
        <p>Drop GLB file here</p>
        <p style="font-size: 12px; color: #666;">Or use the file input below</p>
    </div>
    
    <!-- Controls Panel -->
    <div id="controls">
        <div class="collapsible-panel main-panel">
            <div class="panel-header" data-panel="scene-controls" data-target="controls">
                <span>3D Scene Controls</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <!-- Model Controls -->
                <div id="model-controls" style="display: none;">
                    <div class="control-group">
                        <label>Position X</label>
                        <input type="range" id="pos-x" min="-10" max="10" step="0.1" value="0">
                        <span class="slider-value" id="pos-x-val">0.0</span>
                    </div>
                    <div class="control-group">
                        <label>Position Z</label>
                        <input type="range" id="pos-z" min="-10" max="10" step="0.1" value="0">
                        <span class="slider-value" id="pos-z-val">0.0</span>
                    </div>
                    <div class="control-group">
                        <label>Scale</label>
                        <input type="range" id="scale" min="0.1" max="3" step="0.1" value="1">
                        <span class="slider-value" id="scale-val">1.0</span>
                    </div>
                    <div class="control-group">
                        <label>Rotation Y</label>
                        <input type="range" id="rot-y" min="0" max="360" step="1" value="0">
                        <span class="slider-value" id="rot-y-val">0°</span>
                    </div>
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="backlight-toggle"> Backlight Effect
                        </label>
                    </div>
                    <button id="clear-model-btn" style="display: none;">Clear Model</button>
                </div>
                
                <!-- GLB Model Loading -->
                <div class="control-group">
                    <label>Load GLB Model</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="glb-file-input" accept=".glb,.gltf" />
                        <span class="file-input-display">Choose GLB File</span>
                    </div>
                </div>
                
                <!-- Scene Controls -->
                <div class="control-group">
                    <label>Background Color</label>
                    <input type="color" id="bg-color" value="#cccccc">
                </div>
                
                <!-- Canvas Editor Toggle -->
                <div class="control-group">
                    <button id="toggle-canvas-btn">Toggle Canvas Editor</button>
                </div>
                
                <!-- Developer Tools -->
                <div class="control-group">
                    <button id="lighting-dev-btn">Lighting Console</button>
                </div>
            </div>
        </div>
        
        <!-- Authentication -->
        <div class="collapsible-panel">
            <div class="panel-header" data-panel="auth-controls">
                <span>User Authentication</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <div id="authSection">
                    <form id="loginForm" style="display: block;">
                        <div class="control-group">
                            <label>Email</label>
                            <input type="email" id="loginEmail" placeholder="your@email.com" required>
                        </div>
                        <div class="control-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" placeholder="Password" required>
                        </div>
                        <button type="submit" style="width: 100%; margin-top: 8px;">Login</button>
                    </form>
                    <div id="userInfo" style="display: none;">
                        <div class="control-group">
                            <p style="font-size: 11px; color: #28a745; margin: 0;">
                                ✓ Logged in as: <span id="userEmail"></span>
                            </p>
                            <button id="logoutBtn" style="width: 100%; margin-top: 8px; background: #dc3545; border-color: #dc3545;">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status -->
        <div class="control-group">
            <div id="status" style="font-size: 10px; color: #666;">Drop a GLB file to begin</div>
            <div id="performance-info" style="margin-top: 4px; font-size: 10px; color: #666;">Performance: 60 FPS</div>
            <div id="quality-info" style="margin-top: 4px; font-size: 10px; color: #666;">Resolution: 1024x1024</div>
        </div>
    </div>
    
    <!-- Canvas Editor Panel -->
    <div id="canvas-editor">
        <div class="ui-resizer vertical" data-panel="canvas-editor"></div>
        
        <div class="collapsible-panel main-panel">
            <div class="panel-header" data-panel="canvas-editor">
                <span>Canvas Texture Editor</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <!-- Single Canvas Container - Direct Texture Editing -->
                <div class="canvas-container">
                    <canvas id="display-canvas" width="1024" height="1024"></canvas>
                </div>
                
                <!-- Image Tools -->
                <div class="image-tools">
                    <div class="tool-section">
                        <h4>Add Images</h4>
                        <div class="file-input-wrapper">
                            <input type="file" id="image-upload" accept="image/*" multiple />
                            <span class="file-input-display">Upload Images (JPG/PNG)</span>
                        </div>
                    </div>
                    
                    <div class="tool-section">
                        <h4>Layer Management</h4>
                        <div class="layer-list" id="layer-list">
                            <div style="padding: 12px; text-align: center; color: #666; font-size: 11px;">
                                No images added yet
                            </div>
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button id="delete-selected">Delete Selected</button>
                            <button id="clear-all" class="danger">Clear All</button>
                        </div>
                    </div>
                    
                    <div class="tool-section">
                        <h4>Layer Order</h4>
                        <div style="display: flex; gap: 8px;">
                            <button id="bring-forward">Bring Forward</button>
                            <button id="send-backward">Send Backward</button>
                        </div>
                    </div>
                    
                    <div class="tool-section">
                        <h4>Quality Settings</h4>
                        <div class="control-group">
                            <label>Texture Quality</label>
                            <select id="quality-selector">
                                <option value="1024" selected>High (1024x1024)</option>
                                <option value="512">Medium (512x512)</option>
                                <option value="256">Low (256x256)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script src="env.js"></script>
    <script src="auth.js"></script>
    <!-- Simple coordinate system - no scaling complexity -->
    <script src="simple-coordinate-system.js"></script>
    <script src="scene-manager.js"></script>
    <script src="model-loader.js"></script>
    <script src="canvas-editor.js"></script>
    <!-- Simple layer system - works entirely in 512x512 space -->
    <script src="simple-layer-manager.js"></script>
    <script src="simple-interactive-editor.js"></script>
    <script src="ui-controls.js"></script>
    <script src="main.js"></script>
    <script>
        // All initialization is now handled by main.js
    </script>
</body>
</html>