<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D GLB Scene Editor - Canvas-to-Texture Pipeline</title>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow: hidden; background: #1a1a1a; color: #fff; }
        canvas#three-canvas { position: fixed; top: 0; left: 0; z-index: 1; }
        
        /* Controls Panel - Three.js-style */
        #controls { position: fixed; top: 10px; left: 10px; background: rgba(20, 20, 20, 0.95); border: 1px solid #333; border-radius: 6px; padding: 12px; width: 280px; max-height: calc(100vh - 40px); overflow-y: auto; z-index: 100; font-size: 12px; backdrop-filter: blur(10px); }
        
        .collapsible-panel { margin-bottom: 12px; border: 1px solid #444; border-radius: 4px; background: rgba(40, 40, 40, 0.6); }
        .panel-header { background: #333; padding: 8px 12px; cursor: pointer; user-select: none; display: flex; justify-content: space-between; align-items: center; border-radius: 3px 3px 0 0; }
        .panel-header:hover { background: #444; }
        
        /* Admin Panel Special Styling */
        .admin-panel { border: 1px solid #8b3535; }
        .admin-header { 
            background: linear-gradient(135deg, #4a2525 0%, #3a1818 100%); 
            border-bottom: 1px solid #8b3535;
        }
        .admin-header:hover { 
            background: linear-gradient(135deg, #5a3030 0%, #4a2020 100%); 
        }
        .panel-toggle { font-size: 10px; color: #aaa; }
        .panel-content { padding: 10px; }
        .collapsible-panel.collapsed .panel-content { display: none; }
        
        .control-group { margin-bottom: 12px; }
        .control-group label { display: block; margin-bottom: 4px; color: #ccc; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
        .control-group input, .control-group select { width: 100%; padding: 6px 8px; background: #222; border: 1px solid #555; border-radius: 3px; color: #fff; font-size: 11px; }
        .control-group input[type="range"] { padding: 0; height: 20px; }
        .control-group input:focus { outline: none; border-color: #0084ff; box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.2); }
        
        /* Hide spinner arrows for number inputs */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        button { background: #333; color: #fff; border: 1px solid #555; padding: 8px 12px; border-radius: 3px; cursor: pointer; font-size: 11px; }
        button:hover { background: #444; }
        button:active { background: #222; }
        
        /* Range Slider Styling */
        input[type="range"] { -webkit-appearance: none; appearance: none; height: 4px; background: #444; outline: none; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #0084ff; cursor: pointer; border-radius: 50%; }
        input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; background: #0084ff; cursor: pointer; border-radius: 50%; border: none; }
        
        .slider-value { display: inline-block; min-width: 40px; text-align: right; color: #0084ff; font-weight: 500; }
        
        
        /* Canvas Editor Panel */
        #canvas-editor { position: fixed; top: 10px; right: 10px; background: rgba(20, 20, 20, 0.95); border: 1px solid #333; border-radius: 6px; width: 450px; max-height: calc(100vh - 40px); overflow-y: auto; z-index: 100; backdrop-filter: blur(10px); transition: width 0.3s ease; }
        #canvas-editor.panel-collapsed { width: auto; max-width: 200px; }
        
        /* Keyboard Shortcuts Overlay */
        #keyboard-shortcuts-overlay {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 11px;
            color: #ccc;
            z-index: 150;
            backdrop-filter: blur(10px);
            display: none;
            white-space: nowrap;
        }
        
        #keyboard-shortcuts-overlay.visible { display: block; }
        
        .shortcut-key {
            background: #444;
            border: 1px solid #666;
            border-radius: 3px;
            padding: 2px 6px;
            margin: 0 2px;
            font-family: monospace;
            font-weight: bold;
            color: #fff;
        }
        
        /* Canvas Container */
        .canvas-container { padding: 12px; display: flex; flex-direction: column; align-items: center; }
        #display-canvas { 
            border: 2px solid #555; 
            border-radius: 4px; 
            max-width: 100%; 
            height: auto; 
            background: white; 
            cursor: default; 
        }
        
        #display-canvas:hover { border-color: #777; }
        #display-canvas.dragging { cursor: move; }
        #display-canvas.resizing { cursor: nw-resize; }
        
        /* Image Tools - Simplified */
        .image-tools { margin-top: 12px; }
        .tool-section { 
            margin-bottom: 16px; 
            padding: 12px; 
            background: rgba(40, 40, 40, 0.6); 
            border-radius: 4px; 
        }
        
        .tool-section h4 { 
            margin: 0 0 12px 0; 
            font-size: 12px; 
            color: #ccc; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        
        /* File Input Styling */
        .file-input-wrapper { 
            position: relative; 
            display: inline-block; 
            width: 100%; 
        }
        
        .file-input-wrapper input[type=file] { 
            position: absolute; 
            opacity: 0; 
            width: 100%; 
            height: 100%; 
            cursor: pointer; 
        }
        
        .file-input-display { 
            display: block; 
            padding: 8px 12px; 
            background: #333; 
            color: #fff; 
            border: 1px solid #555; 
            border-radius: 3px; 
            text-align: center; 
            cursor: pointer; 
        }
        
        .file-input-display:hover { background: #444; }
        
        /* Layer Management */
        .layer-list { 
            max-height: 200px; 
            overflow-y: auto; 
            border: 1px solid #555; 
            border-radius: 3px; 
            background: #222; 
        }
        
        .layer-item { 
            padding: 8px 12px; 
            border-bottom: 1px solid #333; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
        }
        
        .layer-item:last-child { border-bottom: none; }
        .layer-item:hover { background: #333; }
        .layer-item.selected { background: #0084ff; color: white; }
        
        .layer-info { 
            flex: 1; 
            font-size: 11px; 
        }
        
        .layer-controls { 
            display: flex; 
            gap: 4px; 
        }
        
        .layer-controls button { 
            padding: 4px 6px; 
            font-size: 10px; 
            min-width: auto; 
        }
        
        button.primary { background: #0084ff; border-color: #0084ff; }
        button.primary:hover { background: #0066cc; }
        button.danger { background: #cc3333; border-color: #cc3333; }
        button.danger:hover { background: #aa2222; }
        
        /* Color Modal */
        #colorModal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a1a; padding: 24px; border-radius: 8px; width: 400px; max-width: 90vw; border: 1px solid #333; }
        .color-preview { width: 60px; height: 60px; border: 2px solid #555; border-radius: 6px; margin: 12px 0; }
        .recent-colors { display: flex; gap: 8px; margin: 12px 0; }
        .swatch-preview { width: 24px; height: 24px; border: 1px solid #555; border-radius: 4px; cursor: pointer; }
        .swatch-preview:hover { border-color: #0084ff; }
        
        /* Quick Swatches */
        #quickSwatches { display: flex; gap: 4px; align-items: center; }
        
        /* UI Resizer */
        .ui-resizer { position: absolute; background: #333; opacity: 0.3; transition: opacity 0.2s; }
        .ui-resizer:hover, .ui-resizer.resizing { opacity: 0.8; }
        .ui-resizer.vertical { top: 0; right: -3px; width: 6px; height: 100%; cursor: ew-resize; }
        .ui-resizer.horizontal { bottom: -3px; left: 0; width: 100%; height: 6px; cursor: ns-resize; }
        
        /* Performance Info */
        .performance-info { position: fixed; bottom: 10px; right: 10px; background: rgba(20, 20, 20, 0.9); padding: 8px 12px; border-radius: 4px; font-size: 10px; color: #aaa; z-index: 50; }
        
        /* Model Library Styles */
        .library-model-item { 
            transition: background-color 0.2s ease; 
        }
        .library-model-item:last-child { 
            border-bottom: none !important; 
        }
        .library-model-item.selected {
            background: #0084ff !important;
            color: white !important;
        }
        .library-model-item:hover {
            background: #333 !important;
        }
        .library-model-item.selected:hover {
            background: #0066cc !important;
        }
        
        /* Model Library Panel Positioning */
        #library-panel.panel-collapsed { 
            width: auto; 
            max-width: 200px; 
        }
        
        /* Responsive adjustments for smaller screens */
        @media (max-width: 1200px) {
            #library-panel {
                left: 300px !important;
                width: 280px !important;
            }
        }
        
        @media (max-width: 1000px) {
            #library-panel {
                left: 290px !important;
                width: 260px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Keyboard Shortcuts Overlay -->
    <div id="keyboard-shortcuts-overlay">
        <span class="shortcut-key">R</span> Rotate
        <span class="shortcut-key">G</span> Move  
        <span class="shortcut-key">S</span> Scale
        <span class="shortcut-key">ESC</span> Deselect
    </div>
    
    <!-- Controls Panel -->
    <div id="controls">
        <div class="collapsible-panel main-panel">
            <div class="panel-header" data-panel="scene-controls" data-target="controls">
                <span>3D Scene Controls</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <!-- Model Controls -->
                <div id="model-controls" style="display: none;">
                    <div class="control-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                            <label style="margin-bottom: 0;">Rotation Y</label>
                            <input type="number" id="rot-y-input" min="0" max="360" step="1" value="0" style="width: 80px; -webkit-appearance: none; -moz-appearance: textfield;">
                        </div>
                        <input type="range" id="rot-y" min="0" max="360" step="1" value="0" style="width: 100%;">
                    </div>
                </div>
                
                <!-- GLB Model Loading - Moved to Admin Panel -->
                
                <!-- Model Library and Canvas Editor -->
                <div class="control-group">
                    <div style="display: flex; gap: 8px;">
                        <button id="add-model-btn" style="flex: 1; background: #28a745; border-color: #28a745;">+ Add Model</button>
                        <button id="toggle-canvas-btn" style="flex: 1;">Canvas Editor</button>
                    </div>
                </div>
                
                <!-- Saved Designs -->
                <div class="control-group">
                    <button id="toggle-saved-designs-btn" style="width: 100%; background: #6f42c1; border-color: #6f42c1;" onclick="toggleSavedDesigns()">💾 Saved Designs</button>
                </div>
            </div>
        </div>
        
        <!-- Scene Controls -->
        <div class="collapsible-panel">
            <div class="panel-header" data-panel="scene-controls">
                <span>Scene Controls</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <div class="control-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <label style="margin-bottom: 0;">Brightness</label>
                        <input type="number" id="material-brightness-input" min="0" max="3" step="0.01" value="1" style="width: 80px; -webkit-appearance: none; -moz-appearance: textfield;">
                    </div>
                    <input type="range" id="material-brightness" min="0" max="3" step="0.01" value="1" style="width: 100%;">
                </div>
                <div class="control-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <label style="margin-bottom: 0;">Lighting Intensity</label>
                        <input type="number" id="lighting-intensity-input" min="0" max="3" step="0.01" value="1" style="width: 80px; -webkit-appearance: none; -moz-appearance: textfield;">
                    </div>
                    <input type="range" id="lighting-intensity" min="0" max="3" step="0.01" value="1" style="width: 100%;">
                </div>
                <div class="control-group">
                    <label>Background Color</label>
                    <input type="color" id="bg-color" value="#dddddd">
                </div>
                <div class="control-group">
                    <label>Floor Color</label>
                    <input type="color" id="floor-color" value="#222222">
                </div>
                <div class="control-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <label style="margin-bottom: 0;">Floor Width (feet)</label>
                        <input type="number" id="floor-width-input" min="6" max="30" step="0.5" value="10" style="width: 80px; -webkit-appearance: none; -moz-appearance: textfield;">
                    </div>
                    <input type="range" id="floor-width" min="6" max="30" step="0.5" value="10" style="width: 100%;">
                </div>
                <div class="control-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <label style="margin-bottom: 0;">Floor Depth (feet)</label>
                        <input type="number" id="floor-depth-input" min="6" max="30" step="0.5" value="10" style="width: 80px; -webkit-appearance: none; -moz-appearance: textfield;">
                    </div>
                    <input type="range" id="floor-depth" min="6" max="30" step="0.5" value="10" style="width: 100%;">
                </div>
                <div class="control-group">
                    <label style="margin-bottom: 6px;">Trade Show Booth Presets</label>
                    <div style="display: flex; gap: 4px;">
                        <button id="floor-preset-3x3" style="flex: 1; padding: 4px 8px; font-size: 10px;">10×10</button>
                        <button id="floor-preset-3x6" style="flex: 1; padding: 4px 8px; font-size: 10px;">10×20</button>
                        <button id="floor-preset-6x6" style="flex: 1; padding: 4px 8px; font-size: 10px;">20×20</button>
                    </div>
                </div>
                <!-- Scene Display Controls -->
                <div style="margin-top: 8px; display: flex; flex-direction: column; gap: 6px;">
                    <label style="display: inline-flex; align-items: center; gap: 6px; cursor: pointer; font-size: 11px;">
                        <input type="checkbox" id="grid-toggle" checked style="margin: 0; vertical-align: middle;">
                        Show Scale Grid
                    </label>
                    <button id="camera-toggle" style="padding: 4px 8px; font-size: 11px; cursor: pointer;">
                        📷 Perspective View
                    </button>
                </div>
                <!-- Developer Console Buttons - Moved to Admin Panel -->
            </div>
        </div>
        
        <!-- Authentication -->
        <div class="collapsible-panel">
            <div class="panel-header" data-panel="auth-controls">
                <span>User Authentication</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <div id="authSection">
                    <form id="loginForm" style="display: block;">
                        <div class="control-group">
                            <label>Email</label>
                            <input type="email" id="loginEmail" placeholder="your@email.com" required>
                        </div>
                        <div class="control-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" placeholder="Password" required>
                        </div>
                        <button type="submit" style="width: 100%; margin-top: 8px;">Login</button>
                    </form>
                    <div id="userInfo" style="display: none;">
                        <div class="control-group">
                            <p style="font-size: 11px; color: #28a745; margin: 0;">
                                ✓ Logged in as: <span id="userEmail"></span>
                            </p>
                            <button id="logoutBtn" style="width: 100%; margin-top: 8px; background: #dc3545; border-color: #dc3545;">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Panel - Only visible to Admin/Superuser -->
        <div class="collapsible-panel admin-panel" id="admin-panel" style="display: none;">
            <div class="panel-header admin-header" data-panel="admin-controls">
                <span>🔐 Admin Tools</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <!-- GLB Model Upload (Admin Only) -->
                <div class="control-group">
                    <label>Upload GLB Model to Database</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="glb-upload-input" accept=".glb,.gltf" />
                        <span class="file-input-display">Choose GLB to Upload</span>
                    </div>
                    <div id="upload-progress" style="display: none; margin-top: 8px; padding: 6px; background: rgba(0,132,255,0.1); border-radius: 3px; font-size: 10px; color: #0084ff;">
                        Uploading...
                    </div>
                </div>
                
                <!-- Developer Console Buttons -->
                <div class="control-group">
                    <label>Developer Consoles</label>
                    <button id="lighting-dev-btn" style="width: 49%; margin-right: 2%;">Lighting Console</button>
                    <button id="shadow-dev-btn" style="width: 49%;">Shadow Console</button>
                </div>
                
                <!-- Performance Controls (Admin Only) -->
                <div class="control-group">
                    <label>Performance Override</label>
                    <select id="admin-quality-override">
                        <option value="auto">Auto</option>
                        <option value="1024">Force 1024x1024</option>
                        <option value="512">Force 512x512</option>
                        <option value="256">Force 256x256</option>
                    </select>
                </div>
                
                <!-- User Type Display -->
                <div class="control-group" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #444;">
                    <label style="color: #ff6b6b;">Admin Status</label>
                    <div style="font-size: 11px; color: #ccc;">
                        <div>User Type: <span id="admin-user-type" style="color: #ff6b6b;">-</span></div>
                        <div>Group: <span id="admin-user-group" style="color: #888;">-</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Model Inspector Panel - Admin Only -->
        <div class="collapsible-panel admin-panel" id="inspector-panel" style="display: none;">
            <div class="panel-header admin-header" data-panel="inspector-controls">
                <span>🔍 Model Inspector</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <!-- Asset Information -->
                <div class="control-group">
                    <label>Asset Name</label>
                    <input type="text" id="inspector-asset-name" placeholder="Enter asset name">
                </div>
                
                <div class="control-group">
                    <label>Description</label>
                    <input type="text" id="inspector-description" placeholder="Optional description">
                </div>
                
                <!-- Current Dimensions Display -->
                <div class="control-group">
                    <label style="color: #0084ff;">Current Size (Three.js units)</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; font-size: 11px; color: #ccc;">
                        <div>Width: <span id="inspector-current-width" style="color: #fff;">0.00</span></div>
                        <div>Height: <span id="inspector-current-height" style="color: #fff;">0.00</span></div>
                        <div>Depth: <span id="inspector-current-depth" style="color: #fff;">0.00</span></div>
                    </div>
                </div>
                
                <!-- Model Information -->
                <div class="control-group">
                    <label style="color: #888;">Model Info</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; color: #ccc;">
                        <div>Materials: <span id="inspector-material-count" style="color: #fff;">0</span></div>
                        <div>Triangles: <span id="inspector-triangle-count" style="color: #fff;">0</span></div>
                    </div>
                </div>
                
                <!-- Real-World Input -->
                <div class="control-group">
                    <label style="color: #ff6b6b;">Real-World Dimensions</label>
                    <div style="display: flex; gap: 4px; margin-bottom: 8px;">
                        <select id="inspector-dimension-type" style="flex: 1;">
                            <option value="height">Height</option>
                            <option value="width">Width</option>
                            <option value="depth">Depth</option>
                        </select>
                        <input type="number" id="inspector-real-value" step="0.1" placeholder="91" style="flex: 1;">
                        <select id="inspector-units" style="flex: 1;">
                            <option value="inches">inches</option>
                            <option value="feet">feet</option>
                            <option value="centimeters">cm</option>
                            <option value="meters">meters</option>
                        </select>
                    </div>
                </div>
                
                <!-- Scale Preview -->
                <div class="control-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label style="color: #00ff88;">Scale Factor:</label>
                        <span id="inspector-scale-factor" style="color: #00ff88; font-weight: 500;">1.000</span>
                    </div>
                    <div id="inspector-validation-message" style="font-size: 10px; color: #ff6b6b; margin-bottom: 8px;"></div>
                </div>
                
                <!-- Actions -->
                <div class="control-group">
                    <div style="display: flex; gap: 4px; margin-bottom: 8px;">
                        <button id="inspector-preview-scale" style="flex: 1; background: #0084ff; border-color: #0084ff;">Preview Scale</button>
                        <button id="inspector-reset-scale" style="flex: 1;">Reset</button>
                    </div>
                    <button id="inspector-save-database" style="width: 100%; background: #28a745; border-color: #28a745; margin-bottom: 8px;">Save to Database</button>
                    <button id="inspector-close" style="width: 100%; background: #6c757d; border-color: #6c757d;">Close Inspector</button>
                </div>
                
                <!-- Visual Aids Toggle -->
                <div class="control-group">
                    <label style="display: inline-flex; align-items: center; gap: 6px; cursor: pointer; font-size: 11px;">
                        <input type="checkbox" id="inspector-show-reference" style="margin: 0; vertical-align: middle;">
                        Show Reference Objects
                    </label>
                    <label style="display: inline-flex; align-items: center; gap: 6px; cursor: pointer; font-size: 11px; margin-top: 4px;">
                        <input type="checkbox" id="inspector-show-bounds" style="margin: 0; vertical-align: middle;">
                        Show Bounding Box
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Status -->
        <div class="control-group">
            <div id="status" style="font-size: 10px; color: #666;">Drop a GLB file to begin</div>
            <div id="performance-info" style="margin-top: 4px; font-size: 10px; color: #666;">Performance: 60 FPS</div>
            <div id="quality-info" style="margin-top: 4px; font-size: 10px; color: #666;">Resolution: 1024x1024</div>
            
            <!-- Object Selection Info -->
            <div class="control-group" id="selection-info" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid #444;">
                <label style="color: #0084ff;">Selected Object</label>
                <div style="font-size: 11px; color: #ccc;">
                    <div>Name: <span id="selected-name" style="color: #fff;">-</span></div>
                    <div>UUID: <span id="selected-uuid" style="color: #888; font-size: 10px;">-</span></div>
                    <div>Position: <span id="selected-position" style="color: #fff;">-</span></div>
                </div>
                <div style="font-size: 10px; color: #888; margin-top: 8px; padding-top: 6px; border-top: 1px solid #333;">
                    <div style="margin-bottom: 2px;">• Drag object to move in XZ plane</div>
                    <div>• Drag green ring to rotate around Y-axis</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Model Library Panel -->
    <div id="library-panel" style="position: fixed; top: 10px; left: 310px; background: rgba(20, 20, 20, 0.95); border: 1px solid #333; border-radius: 6px; width: 320px; max-height: calc(100vh - 40px); overflow-y: auto; z-index: 100; font-size: 12px; backdrop-filter: blur(10px); display: none;">
        <div class="collapsible-panel main-panel">
            <div class="panel-header" data-panel="library-controls" data-target="library-panel">
                <span>📚 Model Library</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content" style="padding: 12px;">
                <!-- Search and Filter -->
                <div class="control-group">
                    <label>Search Models</label>
                    <input type="text" id="library-search" placeholder="Search by name...">
                </div>
                
                <!-- Model List -->
                <div class="control-group">
                    <label>Available Models</label>
                    <div id="library-model-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #555; border-radius: 3px; background: #222;">
                        <div id="library-loading" style="padding: 20px; text-align: center; color: #666; font-size: 11px;">
                            Loading models...
                        </div>
                    </div>
                </div>
                
                <!-- Selected Model Info -->
                <div class="control-group" id="library-selected-info" style="display: none;">
                    <label style="color: #0084ff;">Selected Model</label>
                    <div style="padding: 8px; background: rgba(0,132,255,0.1); border-radius: 3px; font-size: 11px;">
                        <div><strong id="library-selected-name">-</strong></div>
                        <div style="color: #ccc; margin-top: 4px;">
                            <span id="library-selected-dimensions">-</span><br>
                            <span id="library-selected-materials">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="control-group">
                    <div style="display: flex; gap: 8px;">
                        <button id="library-load-model" style="flex: 1; background: #0084ff; border-color: #0084ff;" disabled>Load Model</button>
                        <button id="library-close" style="flex: 1; background: #6c757d; border-color: #6c757d;">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Saved Designs Panel -->
    <div id="saved-designs" class="hidden" style="position: fixed; top: 50px; right: 20px; width: 300px; height: 400px; background: rgba(32, 32, 32, 0.95); border: 1px solid #666; border-radius: 8px; z-index: 1000; display: flex; flex-direction: column;">
        <div class="ui-resizer vertical" data-panel="saved-designs"></div>
        
        <div class="collapsible-panel main-panel">
            <div class="panel-header" data-panel="saved-designs">
                <span>Saved Designs</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <!-- Save Current Scene -->
                <div class="control-group">
                    <label>Save Current Scene</label>
                    <input type="text" id="scene-name-input" placeholder="Enter design name" style="margin-bottom: 8px;">
                    <textarea id="scene-description-input" placeholder="Optional description" rows="2" style="margin-bottom: 8px; width: 100%; resize: vertical;"></textarea>
                    <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                        <button id="save-scene-btn" style="flex: 1; background: #28a745; border-color: #28a745;">Save Design</button>
                        <button id="save-scene-loading" style="display: none; flex: 1;" disabled>Saving...</button>
                    </div>
                </div>
                
                <!-- Saved Scenes List -->
                <div class="control-group">
                    <label>Your Saved Designs</label>
                    <div id="saved-scenes-list" style="max-height: 250px; overflow-y: auto; border: 1px solid #444; border-radius: 4px; padding: 8px;">
                        <div id="scenes-loading" style="text-align: center; color: #888; padding: 20px;">
                            Loading your designs...
                        </div>
                        <div id="scenes-empty" style="display: none; text-align: center; color: #666; padding: 20px; font-size: 12px;">
                            No saved designs yet.<br>Save your current scene to get started!
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="control-group">
                    <button id="refresh-scenes" style="width: 100%; background: #6c757d; border-color: #6c757d;">Refresh List</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Canvas Editor Panel -->
    <div id="canvas-editor">
        <div class="ui-resizer vertical" data-panel="canvas-editor"></div>
        
        <div class="collapsible-panel main-panel">
            <div class="panel-header" data-panel="canvas-editor">
                <span>Canvas Texture Editor</span>
                <span class="panel-toggle">▼</span>
            </div>
            <div class="panel-content">
                <!-- Single Canvas Container - Direct Texture Editing -->
                <div class="canvas-container">
                    <canvas id="display-canvas" width="1024" height="1024"></canvas>
                </div>
                
                <!-- Image Tools -->
                <div class="image-tools">
                    <div class="tool-section">
                        <h4>Add Images</h4>
                        <div class="file-input-wrapper">
                            <input type="file" id="image-upload" accept="image/*" multiple />
                            <span class="file-input-display">Upload Images (JPG/PNG)</span>
                        </div>
                    </div>
                    
                    <div class="tool-section">
                        <h4>Layer Management</h4>
                        <div class="layer-list" id="layer-list">
                            <div style="padding: 12px; text-align: center; color: #666; font-size: 11px;">
                                No images added yet
                            </div>
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button id="delete-selected">Delete Selected</button>
                            <button id="clear-selection">Clear Selection</button>
                            <button id="clear-all" class="danger">Clear All</button>
                        </div>
                    </div>
                    
                    <div class="tool-section">
                        <h4>Layer Order</h4>
                        <div style="display: flex; gap: 8px;">
                            <button id="bring-forward">Bring Forward</button>
                            <button id="send-backward">Send Backward</button>
                        </div>
                    </div>
                    
                    <div class="tool-section">
                        <h4>Quality Settings</h4>
                        <div class="control-group">
                            <label>Texture Quality</label>
                            <select id="quality-selector">
                                <option value="1024" selected>High (1024x1024)</option>
                                <option value="512">Medium (512x512)</option>
                                <option value="256">Low (256x256)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/OutlinePass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script src="env.js"></script>
    <script src="auth.js"></script>
    <!-- Simple coordinate system - no scaling complexity -->
    <script src="simple-coordinate-system.js"></script>
    <script src="scene-manager.js"></script>
    <script src="model-loader.js"></script>
    <script src="model-uploader.js"></script>
    <script src="model-library.js"></script>
    <script src="simple-selection-visualization.js"></script>
    <script src="optimized-selection-system.js"></script>
    <script src="transform-controls-manager.js"></script>
    <script src="system-initializer.js"></script>
    <!-- Simple layer system - works entirely in 512x512 space -->
    <script src="simple-layer-manager.js"></script>
    <script src="simple-interactive-editor.js"></script>
    <script src="ui-controls.js"></script>
    <!-- Scene serialization and saved designs system -->
    <script src="scene-serializer.js"></script>
    <script src="asset-manager.js"></script>
    <script src="saved-scene-manager.js"></script>
    <script src="saved-designs-ui.js"></script>
    <script src="main.js"></script>
    <script>
        // All initialization is now handled by main.js
    </script>
</body>
</html>